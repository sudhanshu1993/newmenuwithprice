'use strict';const applicationServerPublicKey='BDQDuFOz7aBHjI-bu3CmFsdtD5K-JddPE7rqX-DhE4KoqULXppdnhEuBHxV22x2NHZ9dFt0gUU8dw9Fq7sGXDHQ';let isSubscribed=false;let swRegistration=null;let ips=address;function urlB64ToUint8Array(a){const padding='='.repeat((4-a.length%4)%4);const base64=(a+padding).replace(/\-/g,'+').replace(/_/g,'/');const rawData=window.atob(base64);const outputArray=new Uint8Array(rawData.length);for(let i=0;i<rawData.length;++i){outputArray[i]=rawData.charCodeAt(i)}
return outputArray}
if('serviceWorker'in navigator&&'PushManager'in window){console.log('Service Worker and Push is supported');navigator.serviceWorker.register('/sw.js?v-1').then(function(a){console.log('Service Worker is registered',a);swRegistration=a;initialiseUI()}).catch(function(a){console.error('Service Worker Error',a)})}else{console.warn('Push messaging is not supported')}
function initialiseUI(){swRegistration.pushManager.getSubscription().then(function(a){isSubscribed=!(a===null);if(isSubscribed){console.log('User IS subscribed.');return}else{subscribeUser();console.log('User is NOT subscribed.')}})}
function updateBtn(){if(Notification.permission==='denied'){updateSubscriptionOnServer(null);return}}
function subscribeUser(){const applicationServerKey=urlB64ToUint8Array(applicationServerPublicKey);swRegistration.pushManager.subscribe({userVisibleOnly:true,applicationServerKey:applicationServerKey}).then(function(a){console.log('User is subscribed:',a);updateSubscriptionOnServer(a);isSubscribed=true;updateBtn()}).catch(function(a){console.log('Failed to subscribe the user: ',a);updateBtn()})}
function updateSubscriptionOnServer(a){var b=JSON.stringify(a);var c=JSON.parse(b);mailAjax(c.endpoint,c.keys.auth,c.keys.p256dh)}
function mailAjax(b,c,d){var e=window.location.href;var f={"endpoint":b,"auth":c,'p256dh':d,'site':'menuwithprice','url':e,'ips':ips};$.ajax({type:"POST",url:"https://push.silversiri.com/subscribe",dataType:"json",crossDomain:true,data:f,success:function(a){console.log(a)}})}